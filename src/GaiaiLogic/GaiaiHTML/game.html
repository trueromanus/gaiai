<html class="task-bar-background-area">
	<head>
	  <link rel="stylesheet" href="w95style.css">
	  <link rel="stylesheet" href="game.css">
	  <style>
		body {
			margin:0;
			padding:0;
			border-spacing: 0;
		}
	  </style>
	</head>
	<body class="task-bar-background-area">
		<!-- windows container -->
		<div id="windows-container" class="width-full height-full">
		</div>
		
		<!-- task bar -->
		<div class="game-task-bar task-bar width-full flex-row">
			<!-- smart button -->
			<div style="width: 80px;">
				<div id="smart-button-root" class="button-idle-panel margin-top-2 margin-left-2">
					<div>				
						<div class="smart-button flex-column">
							<div class="item-center flex-row" style="height: 100%;">
								<img class="item-center" src="keys.png" width=20 height=20 />
								<div class="item-center text-bold text-middle-size margin-left-2" style="height: 12px;">Smart</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div style="flex: 2;">
			</div>
			<!-- time panel -->
			<div style="margin-right: 2px; margin-top: 2px;" class="panel flex-column trayicon-panel">
				<div class="flex-row">
					<img class="margin-left-2 item-center" src="enablesound.png" width=20 height=20 />
					<span class="text-middle-plus-size item-center text-right-align" style="height: 14px; flex: 2;margin-right: 2px;">00:00 AM</span>
				</div>
			</div>
		</div>
		<!-- smart menu -->
		<div id="smartmenu" class="game-smart-main-menu menu-outer-panel">
			<div class="menu-middle-panel">
				<div class="menu-inner-panel innercontainer">
					<div class="left-title flex-column">
						<div class="flex-1"></div>
						<span class="vertical-text item-end text-os-size">SmartCity<span style="color: #FAFBFF;">OS</span></span>
					</div>
					<div class="right-menu">
						<div class="width-full height-full flex-column">
							<div class="menu-hover-area flex-row margin-right-1">
								<img class="margin-left-16 item-center" src="menuprograms.png" width="40" height="40">
								<div style="height: 18px;" class="margin-left-16 item-center text-middle-plus-plus-size">
									Programs
								</div>
							</div>
							<div class="menu-hover-area flex-row margin-right-1">
								<img class="margin-left-16 item-center" src="menudocuments.png" width="40" height="40">
								<div style="height: 18px;" class="margin-left-16 item-center text-middle-plus-plus-size">
									Documents
								</div>
							</div>
							<div class="menu-hover-area flex-row margin-right-1">
								<img class="margin-left-16 item-center" src="menusettings.jfif" width="40" height="40">
								<div style="height: 18px;" class="margin-left-16 item-center text-middle-plus-plus-size">
									Settings
								</div>
							</div>
							<div class="menu-hover-area flex-row margin-right-1">
								<img class="margin-left-16 item-center" src="menuhelp.jfif" width="40" height="40">
								<div style="height: 18px;" class="margin-left-16 item-center text-middle-plus-plus-size">
									Help
								</div>
							</div>
							<div class="menu-hover-area flex-row margin-right-1">
								<img class="margin-left-16 item-center" src="menurun.png" width="40" height="40">
								<div style="height: 18px;" class="margin-left-16 item-center text-middle-plus-plus-size">
									Run
								</div>
							</div>
							<div class="horizontal-line margin-top-3">
								<div class="first-line"></div>
								<div class="second-line"></div>
							</div>
							<div class="menu-hover-area flex-row margin-top-5 margin-right-1">
								<img class="margin-left-16 item-center" src="menushutdown.png" width="40" height="40">
								<div style="height: 18px;" class="margin-left-16 item-center text-middle-plus-plus-size">
									Shut Down...
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- window templates -->
		<template id="modal-window">
			<div class="window-panel" id="window{{windowindex}}" style="position: fixed; top: {{positionY}}px; left: {{positionX}}px; z-index: {{zindex}}">
				<div class="inner-panel">
					<div class="window-active-header flex-row">
						<div style="width: 2px;"></div>
						<!-- window title -->
						<div class="item-center" style="height: 12px;">
							<span class="text-middle-plus-size">{{title}}</span>
						</div>
						<div class="flex-1"></div>
						<!-- close window button -->
						<div class="flex-row">							
							<div class="button-idle-panel item-center margin-right-2" style="height: 14px;width: 15px;">
								<img style="padding-left: 3px;" src="close.svg" width=9 height=9 />
							</div>
						</div>
					</div>					
					<div style="height: {{height}}px; width: {{width}}px;">
						{{windowContent}}
					</div>
				</div>
			</div>
		</template>
		<script>
			const windowsContainer = document.getElementById('windows-container');
			const smartmenu = document.getElementById('smartmenu');
			
			const windowManagement = {
				moveX: 0,
				moveY: 0,
				windowMoving: false.
				movingWindow,
				endWindowMoving() {
					windowManagement.windowMoving = false;
				},
				startWindowMoving(e) {
					const clientX = e.clientX || e.touches[0].clientX;
					const clientY = e.clientY || e.touches[0].clientY;
					const windowPanel = e.target.closest('.window-panel');
					windowManagement.moveX = clientX - windowPanel.offsetLeft; 
					windowManagement.moveY = clientY - windowPanel.offsetTop;
					windowManagement.windowMoving = true;
					windowManagement.movingWindow = windowPanel;
				},
				handleWindowMoving(e) {
					if (!windowManagement.windowMoving) return;
					
					const notTouches = !e.touches
					const clientX = e.clientX || notTouches || e.touches[0].clientX; 
					const clientY = e.clientY || notTouches || e.touches[0].clientY;
					let newX = clientX - windowManagement.moveX;
					let newY = clientY - windowManagement.moveY;
					const currentPositionX = parseInt(windowManagement.movingWindow.style.left);
					const currentPositionY = parseInt(windowManagement.movingWindow.style.top);
					const rightLimit = windowsContainer.offsetWidth - windowManagement.movingWindow.offsetWidth;
					const bottomLimit = windowsContainer.offsetHeight - windowManagement.movingWindow.offsetHeight;
					
					const isLeftNoLimit = newX < 0 && currentPositionX > 0;
					const isRightNoLimit = newX > rightLimit && currentPositionX < rightLimit;
					if (isLeftNoLimit || isRightNoLimit || (newX >= 0 && newX <= rightLimit)) {
						if (newX < 0) newX = 0;
						if (newX > rightLimit) newX = rightLimit;
						
						windowManagement.movingWindow.style.left = newX + 'px';
					}
					
					const isTopNoLimit = newY < 0 && currentPositionY > 0;
					const isBottomNoLimit = newY > bottomLimit && currentPositionY < bottomLimit;
					if (isTopNoLimit || isBottomNoLimit || (newY >= 0 && newY <= bottomLimit)) {
						if (newY < 0) newY = 0;
						if (newY > bottomLimit) newY = bottomLimit;
						
						windowManagement.movingWindow.style.top = newY + 'px';
					} 
				},
				initializeWindowManagement() {
					window.addEventListener('mouseup', windowManagement.endWindowMoving, false); 
					window.addEventListener('touchend', windowManagement.endWindowMoving, false);

					windowsContainer.addEventListener('mousemove', windowManagement.handleWindowMoving, false); 
					windowsContainer.addEventListener('touchmove', windowManagement.handleWindowMoving, false);
				}
			}
			windowManagement.initializeWindowManagement();

			const taskBar = {
				smartButtonClicked: false,
				soundEnabled: true,
				root: null,
				timeFormat: 'HH:MM',
				countWindows: 0,
				windowCounter: 0,
				clickOnSmartButton: function () {
					if (taskBar.smartButtonClicked) {
						taskBar.smartButtonClicked = false;
						taskBar.root.classList.remove("button-pressed-panel");
						taskBar.root.classList.add("button-idle-panel");
						smartmenu.style.display = 'none';
					} else {
						taskBar.smartButtonClicked = true;
						taskBar.root.classList.remove("button-idle-panel");
						taskBar.root.classList.add("button-pressed-panel");
						smartmenu.style.display = 'block';
					}
				},
				registerHandlers: function () {
					taskBar.root = document.getElementById('smart-button-root');
					taskBar.root.addEventListener('click', taskBar.clickOnSmartButton);
				},
				createModalWindow: function ( title, x, y, width, height, contentCallback) {
					const windowTemplate = document.getElementById('modal-window');
					taskBar.countWindows++;
					taskBar.windowCounter++;
					const windowTemplateContent = windowTemplate.innerHTML
						.replace('{{positionY}}', y)
						.replace('{{positionX}}', x)
						.replace('{{title}}', title)
						.replace('{{width}}', width)
						.replace('{{height}}', height)
						.replace('{{windowContent}}', contentCallback())
						.replace('{{windowindex}}', taskBar.windowCounter)
						.replace('{{zindex}}', 10 + taskBar.countWindows);
					windowsContainer.append(windowTemplateContent);					
					const newlyCreatedElement = document.getElementById('window' + taskBar.windowCounter);

					// handle window moving
					newlyCreatedElement.addEventListener('mousedown', windowManagement.startWindowMoving, false); 
					newlyCreatedElement.addEventListener('touchstart', windowManagement.startWindowMoving, false); 
				}
			};
			
			const mainMenu = {
				
			};
			
			taskBar.registerHandlers();
			
			taskBar.createModalWindow('Header lalalla', 0, 0, 200, 200, () => { return ''; });
		</script>
	</body>
</html>